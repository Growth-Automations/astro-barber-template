---
import type { CollectionEntry } from 'astro:content';
import { resolveImage } from '../../lib/resolve-image';

export interface Props {
  entry: CollectionEntry<'blog'>;
  compact?: boolean;
}

const { entry, compact = false } = Astro.props as Props;
const imageSrc = resolveImage(entry.data.image?.src);
const date = new Date(entry.data.publishedAt).toLocaleDateString('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric'
});
---

<article class={`group relative flex h-full min-h-[480px] flex-col overflow-hidden rounded-[32px] border-2 border-border bg-surface shadow-lg transition-all duration-500 ease-out hover:scale-[1.06] hover:border-primary/70 hover:shadow-2xl hover:shadow-primary/30 ${compact ? '' : ''}`}>
  {imageSrc && (
    <div class="relative aspect-[4/3] overflow-hidden">
      <img class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110" src={imageSrc} alt={entry.data.image?.alt ?? entry.data.title} loading="lazy" />
      <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-black/10 to-transparent transition-opacity duration-300 group-hover:opacity-80" />
      <span class="absolute left-5 top-5 inline-flex items-center rounded-full border border-primary/40 bg-primary/20 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-primary backdrop-blur-sm transition-all duration-300 group-hover:scale-105 dark:border-primary/50 dark:bg-primary/25">
        {entry.data.category}
      </span>
    </div>
  )}
  <div class="flex flex-1 flex-col gap-4 p-8">
    <div class="flex flex-1 flex-col space-y-3">
      <p class="text-xs font-semibold uppercase tracking-[0.35em] text-text transition-colors duration-500 group-hover:text-primary">{date}</p>
      <h3 class="text-xl font-bold text-text transition-colors duration-500 group-hover:text-primary">{entry.data.title}</h3>
      <p class="text-sm leading-relaxed text-text-secondary transition-colors duration-500 group-hover:text-primary">{entry.data.excerpt}</p>
    </div>
    <div class="mt-auto flex items-center justify-between text-sm font-semibold text-primary transition-all duration-500 group-hover:gap-2">
      <span>Read article</span>
      <span class="transition-transform duration-500 group-hover:translate-x-1" aria-hidden="true">â†’</span>
    </div>
    <a class="absolute inset-0" href={`/blog/${entry.id}`} aria-label={`Read ${entry.data.title}`} />
  </div>
</article>
