---
import type { CollectionEntry } from 'astro:content';
import { resolveImage } from '../../lib/resolve-image';
import servicesPhoto from '../../assets/images/photos/barber_services_1.jpg';

export interface Props {
  team: CollectionEntry<'team'>[];
  eyebrow?: string;
  heading: string;
  subheading?: string;
}

const props = Astro.props as Props;
const members = props.team.map((entry) => ({
  entry,
  photo: resolveImage(entry.data.image?.src)
}));
const bgImage = servicesPhoto.src;
---

<section class="relative overflow-hidden bg-surface py-24 sm:py-28 lg:py-32">
  <!-- VISIBLE barbershop background image - much darker and clearer -->
  <div class="absolute inset-0 z-0">
    <img
      src={bgImage}
      alt=""
      class="h-full w-full object-cover object-center opacity-35 dark:opacity-30"
      aria-hidden="true"
      loading="lazy"
    />
  </div>

  <!-- STRONG overlay for crisp text readability -->
  <div class="absolute inset-0 z-[1] bg-background/70 dark:bg-black/60"></div>

  <!-- Subtle decorative accents -->
  <div class="pointer-events-none absolute inset-0 z-[2]">
    <div class="absolute -left-10 bottom-12 h-28 w-28 rounded-full border border-border/25 dark:border-border/15" />
    <div class="absolute right-8 top-8 h-20 w-20 rounded-full border border-border/25 dark:border-border/15" />
  </div>

  <div class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 lg:px-10">
    <div class="text-center mb-4">
      {props.eyebrow && (
        <p class="text-xs font-bold uppercase tracking-[0.45em] text-secondary">{props.eyebrow}</p>
      )}
      <h2 class="mt-5 text-4xl font-bold text-text md:text-5xl lg:text-6xl">{props.heading}</h2>
      {props.subheading && <p class="mt-5 text-xl font-semibold text-text leading-relaxed max-w-3xl mx-auto">{props.subheading}</p>}
    </div>
    <div class="mt-20 grid gap-10 md:grid-cols-2 lg:grid-cols-4">
      {members.map(({ entry, photo }) => (
        <article class="group relative overflow-hidden rounded-3xl border-2 border-border bg-surface p-8 text-center shadow-lg transition-all duration-500 ease-out hover:scale-[1.06] hover:border-primary/70 hover:shadow-2xl hover:shadow-primary/30">
          <div class="mx-auto h-36 w-36 overflow-hidden rounded-full border-[3px] border-border bg-surface-alt shadow-lg ring-4 ring-surface/50">
            {photo ? (
              <img class="h-full w-full object-cover transition duration-500 group-hover:scale-110" src={photo} alt={entry.data.image?.alt ?? entry.data.name} loading="lazy" />
            ) : (
              <div class="flex h-full w-full items-center justify-center text-3xl font-bold text-primary">
                {entry.data.name
                  .split(' ')
                  .map((part) => part[0])
                  .join('')
                  .slice(0, 2)}
              </div>
            )}
          </div>
          <div class="mt-7 space-y-3">
            <h3 class="text-xl font-bold text-text transition-colors duration-500 group-hover:text-primary leading-tight">{entry.data.name}</h3>
            <p class="text-xs text-primary uppercase tracking-[0.4em] font-bold transition-transform duration-500 group-hover:scale-110">{entry.data.role}</p>
            <p class="text-sm font-semibold text-text transition-colors duration-500 group-hover:text-primary leading-[1.7] pt-2">{entry.data.bio}</p>
            {entry.data.specialty && (
              <p class="mt-4 pt-2 text-xs font-bold uppercase tracking-[0.35em] text-text-secondary transition-colors duration-500 group-hover:text-primary">
                {entry.data.specialty}
              </p>
            )}
          </div>
          {entry.data.socials && (
            <div class="mt-7 flex justify-center gap-3">
              {entry.data.socials.map((social) => (
                <a class="inline-flex h-10 w-10 items-center justify-center rounded-full border-2 border-border text-xs font-bold text-text transition-all duration-500 hover:border-primary hover:text-primary hover:bg-primary/10 hover:scale-110" href={social.href}>
                  {social.label[0]}
                </a>
              ))}
            </div>
          )}
        </article>
      ))}
    </div>
  </div>
</section>
